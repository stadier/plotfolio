"use client";

import { useMap } from "@vis.gl/react-google-maps";
import { useEffect, useState } from "react";

interface AdministrativeBoundariesProps {
	showBorders?: boolean;
	onRegionHover?: (regionName: string | null) => void;
	onRegionClick?: (regionName: string) => void;
}

export default function AdministrativeBoundaries({
	showBorders = true,
	onRegionHover,
	onRegionClick,
}: AdministrativeBoundariesProps) {
	const map = useMap();
	const [hoveredRegion, setHoveredRegion] = useState<string | null>(null);

	useEffect(() => {
		if (!map) return;

		// Create an overlay to highlight hovered states
		let hoverOverlay: google.maps.Polygon | null = null;

		// Enhanced styling for Nigerian state boundaries
		const styles = showBorders
			? [
					// State/Province boundaries (Nigerian states)
					{
						featureType: "administrative.province",
						stylers: [
							{ visibility: "on" },
							{ weight: 2.5 },
							{ color: "#4B5563" },
							{ gamma: 1.0 },
						],
					},
					// Administrative area level 1 (states/provinces)
					{
						featureType: "administrative",
						elementType: "geometry.stroke",
						stylers: [
							{ visibility: "on" },
							{ weight: 2 },
							{ color: "#6B7280" },
						],
					},
					// Local government areas within states
					{
						featureType: "administrative.locality",
						stylers: [
							{ visibility: "on" },
							{ weight: 1 },
							{ color: "#9CA3AF" },
						],
					},
					// Country boundaries
					{
						featureType: "administrative.country",
						stylers: [
							{ visibility: "on" },
							{ weight: 3 },
							{ color: "#374151" },
						],
					},
					// Administrative land parcel boundaries
					{
						featureType: "administrative.land_parcel",
						stylers: [
							{ visibility: "on" },
							{ weight: 1.5 },
							{ color: "#8B9DC3" },
						],
					},
			  ]
			: [
					{
						featureType: "administrative.province",
						stylers: [{ visibility: "off" }],
					},
					{
						featureType: "administrative.locality",
						stylers: [{ visibility: "off" }],
					},
					{
						featureType: "administrative",
						elementType: "geometry.stroke",
						stylers: [{ visibility: "off" }],
					},
					{
						featureType: "administrative.land_parcel",
						stylers: [{ visibility: "off" }],
					},
			  ];

		map.setOptions({ styles });

		// Add click listener for administrative areas
		const clickListener = map.addListener(
			"click",
			(event: google.maps.MapMouseEvent) => {
				if (!event.latLng || !showBorders) return;

				// Use Geocoding service to get administrative area info
				const geocoder = new google.maps.Geocoder();
				geocoder.geocode({ location: event.latLng }, (results, status) => {
					if (status === "OK" && results && results[0]) {
						// Find administrative area level 1 (state/province)
						const addressComponents = results[0].address_components;
						const stateComponent = addressComponents.find((component) =>
							component.types.includes("administrative_area_level_1")
						);

						if (stateComponent && onRegionClick) {
							onRegionClick(stateComponent.long_name);
						}
					}
				});
			}
		);

		// Add mousemove listener for hover effects
		let hoverTimeout: NodeJS.Timeout;
		const mouseMoveListener = map.addListener(
			"mousemove",
			(event: google.maps.MapMouseEvent) => {
				if (!event.latLng || !showBorders) return;

				// Debounce the geocoding requests
				clearTimeout(hoverTimeout);
				hoverTimeout = setTimeout(() => {
					const geocoder = new google.maps.Geocoder();
					geocoder.geocode({ location: event.latLng }, (results, status) => {
						if (status === "OK" && results && results[0]) {
							const addressComponents = results[0].address_components;
							const stateComponent = addressComponents.find((component) =>
								component.types.includes("administrative_area_level_1")
							);

							if (stateComponent) {
								const stateName = stateComponent.long_name;
								if (hoveredRegion !== stateName) {
									setHoveredRegion(stateName);
									if (onRegionHover) {
										onRegionHover(stateName);
									}
								}
							}
						}
					});
				}, 200); // 200ms debounce
			}
		);

		return () => {
			clickListener.remove();
			mouseMoveListener.remove();
			clearTimeout(hoverTimeout);
			// Reset map styles when component unmounts
			map.setOptions({ styles: [] });
			
			// Clean up hover overlay
			if (hoverOverlay) {
				hoverOverlay.setMap(null);
			}
		};
	}, [map, showBorders, hoveredRegion, onRegionHover, onRegionClick]);

	return null;
}
		{
			name: "Federal Capital Territory (FCT)",
			coordinates: [
				{ lat: 9.25, lng: 7.05 },
				{ lat: 9.28, lng: 7.15 },
				{ lat: 9.32, lng: 7.35 },
				{ lat: 9.3, lng: 7.55 },
				{ lat: 9.25, lng: 7.75 },
				{ lat: 9.18, lng: 7.8 },
				{ lat: 9.05, lng: 7.82 },
				{ lat: 8.95, lng: 7.75 },
				{ lat: 8.88, lng: 7.65 },
				{ lat: 8.82, lng: 7.45 },
				{ lat: 8.8, lng: 7.25 },
				{ lat: 8.85, lng: 7.1 },
				{ lat: 8.95, lng: 7.05 },
				{ lat: 9.15, lng: 7.02 },
				{ lat: 9.25, lng: 7.05 },
			],
		},
		{
			name: "Lagos State",
			coordinates: [
				{ lat: 6.75, lng: 2.75 },
				{ lat: 6.78, lng: 2.85 },
				{ lat: 6.82, lng: 3.05 },
				{ lat: 6.85, lng: 3.25 },
				{ lat: 6.88, lng: 3.45 },
				{ lat: 6.85, lng: 3.65 },
				{ lat: 6.78, lng: 3.75 },
				{ lat: 6.65, lng: 3.78 },
				{ lat: 6.52, lng: 3.75 },
				{ lat: 6.42, lng: 3.65 },
				{ lat: 6.38, lng: 3.45 },
				{ lat: 6.35, lng: 3.25 },
				{ lat: 6.38, lng: 3.05 },
				{ lat: 6.45, lng: 2.85 },
				{ lat: 6.55, lng: 2.75 },
				{ lat: 6.65, lng: 2.72 },
				{ lat: 6.75, lng: 2.75 },
			],
		},
		{
			name: "Kano State",
			coordinates: [
				{ lat: 13.05, lng: 7.85 },
				{ lat: 13.15, lng: 8.15 },
				{ lat: 13.25, lng: 8.45 },
				{ lat: 13.28, lng: 8.75 },
				{ lat: 13.25, lng: 9.05 },
				{ lat: 13.15, lng: 9.25 },
				{ lat: 12.95, lng: 9.35 },
				{ lat: 12.75, lng: 9.25 },
				{ lat: 12.45, lng: 9.15 },
				{ lat: 12.15, lng: 9.05 },
				{ lat: 11.85, lng: 8.95 },
				{ lat: 11.65, lng: 8.75 },
				{ lat: 11.55, lng: 8.45 },
				{ lat: 11.58, lng: 8.15 },
				{ lat: 11.68, lng: 7.95 },
				{ lat: 11.85, lng: 7.85 },
				{ lat: 12.15, lng: 7.78 },
				{ lat: 12.45, lng: 7.75 },
				{ lat: 12.75, lng: 7.78 },
				{ lat: 13.05, lng: 7.85 },
			],
		},
		{
			name: "Rivers State",
			coordinates: [
				{ lat: 5.35, lng: 6.45 },
				{ lat: 5.45, lng: 6.65 },
				{ lat: 5.52, lng: 6.85 },
				{ lat: 5.55, lng: 7.05 },
				{ lat: 5.52, lng: 7.25 },
				{ lat: 5.45, lng: 7.35 },
				{ lat: 5.25, lng: 7.38 },
				{ lat: 5.05, lng: 7.32 },
				{ lat: 4.85, lng: 7.22 },
				{ lat: 4.68, lng: 7.05 },
				{ lat: 4.58, lng: 6.85 },
				{ lat: 4.55, lng: 6.65 },
				{ lat: 4.62, lng: 6.45 },
				{ lat: 4.75, lng: 6.35 },
				{ lat: 4.95, lng: 6.32 },
				{ lat: 5.15, lng: 6.38 },
				{ lat: 5.35, lng: 6.45 },
			],
		},
		{
			name: "Kaduna State",
			coordinates: [
				{ lat: 11.25, lng: 6.85 },
				{ lat: 11.45, lng: 7.15 },
				{ lat: 11.55, lng: 7.45 },
				{ lat: 11.58, lng: 7.75 },
				{ lat: 11.52, lng: 8.05 },
				{ lat: 11.38, lng: 8.35 },
				{ lat: 11.15, lng: 8.55 },
				{ lat: 10.85, lng: 8.65 },
				{ lat: 10.55, lng: 8.58 },
				{ lat: 10.25, lng: 8.45 },
				{ lat: 9.95, lng: 8.25 },
				{ lat: 9.75, lng: 8.05 },
				{ lat: 9.65, lng: 7.75 },
				{ lat: 9.68, lng: 7.45 },
				{ lat: 9.78, lng: 7.15 },
				{ lat: 9.95, lng: 6.95 },
				{ lat: 10.25, lng: 6.85 },
				{ lat: 10.55, lng: 6.82 },
				{ lat: 10.85, lng: 6.85 },
				{ lat: 11.15, lng: 6.92 },
				{ lat: 11.25, lng: 6.85 },
			],
		},
		{
			name: "Katsina State",
			coordinates: [
				{ lat: 13.85, lng: 6.85 },
				{ lat: 14.05, lng: 7.15 },
				{ lat: 14.15, lng: 7.45 },
				{ lat: 14.18, lng: 7.75 },
				{ lat: 14.15, lng: 8.05 },
				{ lat: 14.05, lng: 8.35 },
				{ lat: 13.85, lng: 8.55 },
				{ lat: 13.55, lng: 8.65 },
				{ lat: 13.25, lng: 8.58 },
				{ lat: 12.95, lng: 8.45 },
				{ lat: 12.65, lng: 8.25 },
				{ lat: 12.45, lng: 8.05 },
				{ lat: 12.35, lng: 7.75 },
				{ lat: 12.38, lng: 7.45 },
				{ lat: 12.48, lng: 7.15 },
				{ lat: 12.65, lng: 6.95 },
				{ lat: 12.95, lng: 6.85 },
				{ lat: 13.25, lng: 6.82 },
				{ lat: 13.55, lng: 6.85 },
				{ lat: 13.85, lng: 6.85 },
			],
		},
		{
			name: "Niger State",
			coordinates: [
				{ lat: 11.45, lng: 5.25 },
				{ lat: 11.65, lng: 5.55 },
				{ lat: 11.75, lng: 5.85 },
				{ lat: 11.78, lng: 6.15 },
				{ lat: 11.72, lng: 6.45 },
				{ lat: 11.58, lng: 6.75 },
				{ lat: 11.35, lng: 6.95 },
				{ lat: 11.05, lng: 7.05 },
				{ lat: 10.75, lng: 6.98 },
				{ lat: 10.45, lng: 6.85 },
				{ lat: 10.15, lng: 6.65 },
				{ lat: 9.85, lng: 6.45 },
				{ lat: 9.65, lng: 6.15 },
				{ lat: 9.55, lng: 5.85 },
				{ lat: 9.58, lng: 5.55 },
				{ lat: 9.68, lng: 5.25 },
				{ lat: 9.85, lng: 5.05 },
				{ lat: 10.15, lng: 4.95 },
				{ lat: 10.45, lng: 5.02 },
				{ lat: 10.75, lng: 5.15 },
				{ lat: 11.05, lng: 5.35 },
				{ lat: 11.25, lng: 5.15 },
				{ lat: 11.45, lng: 5.25 },
			],
		},
		{
			name: "Oyo State",
			coordinates: [
				{ lat: 8.95, lng: 3.35 },
				{ lat: 9.15, lng: 3.65 },
				{ lat: 9.25, lng: 3.95 },
				{ lat: 9.28, lng: 4.25 },
				{ lat: 9.22, lng: 4.55 },
				{ lat: 9.08, lng: 4.75 },
				{ lat: 8.85, lng: 4.85 },
				{ lat: 8.55, lng: 4.78 },
				{ lat: 8.25, lng: 4.65 },
				{ lat: 7.95, lng: 4.45 },
				{ lat: 7.75, lng: 4.25 },
				{ lat: 7.65, lng: 3.95 },
				{ lat: 7.68, lng: 3.65 },
				{ lat: 7.78, lng: 3.35 },
				{ lat: 7.95, lng: 3.15 },
				{ lat: 8.25, lng: 3.05 },
				{ lat: 8.55, lng: 3.12 },
				{ lat: 8.85, lng: 3.25 },
				{ lat: 8.95, lng: 3.35 },
			],
		},
		{
			name: "Borno State",
			coordinates: [
				{ lat: 13.75, lng: 11.35 },
				{ lat: 13.95, lng: 11.65 },
				{ lat: 14.05, lng: 11.95 },
				{ lat: 14.08, lng: 12.25 },
				{ lat: 14.02, lng: 12.55 },
				{ lat: 13.88, lng: 12.85 },
				{ lat: 13.65, lng: 13.05 },
				{ lat: 13.35, lng: 13.15 },
				{ lat: 13.05, lng: 13.08 },
				{ lat: 12.75, lng: 12.95 },
				{ lat: 12.45, lng: 12.75 },
				{ lat: 12.25, lng: 12.55 },
				{ lat: 12.15, lng: 12.25 },
				{ lat: 12.18, lng: 11.95 },
				{ lat: 12.28, lng: 11.65 },
				{ lat: 12.45, lng: 11.45 },
				{ lat: 12.75, lng: 11.35 },
				{ lat: 13.05, lng: 11.32 },
				{ lat: 13.35, lng: 11.35 },
				{ lat: 13.55, lng: 11.42 },
				{ lat: 13.75, lng: 11.35 },
			],
		},
		{
			name: "Ogun State",
			coordinates: [
				{ lat: 7.45, lng: 2.95 },
				{ lat: 7.65, lng: 3.15 },
				{ lat: 7.75, lng: 3.35 },
				{ lat: 7.78, lng: 3.55 },
				{ lat: 7.72, lng: 3.75 },
				{ lat: 7.58, lng: 3.95 },
				{ lat: 7.35, lng: 4.05 },
				{ lat: 7.05, lng: 3.98 },
				{ lat: 6.75, lng: 3.85 },
				{ lat: 6.55, lng: 3.65 },
				{ lat: 6.45, lng: 3.45 },
				{ lat: 6.48, lng: 3.25 },
				{ lat: 6.58, lng: 3.05 },
				{ lat: 6.75, lng: 2.95 },
				{ lat: 7.05, lng: 2.92 },
				{ lat: 7.25, lng: 2.95 },
				{ lat: 7.45, lng: 2.95 },
			],
		},
		{
			name: "Plateau State",
			coordinates: [
				{ lat: 10.35, lng: 8.55 },
				{ lat: 10.55, lng: 8.85 },
				{ lat: 10.65, lng: 9.15 },
				{ lat: 10.68, lng: 9.45 },
				{ lat: 10.62, lng: 9.75 },
				{ lat: 10.48, lng: 9.95 },
				{ lat: 10.25, lng: 10.05 },
				{ lat: 9.95, lng: 9.98 },
				{ lat: 9.65, lng: 9.85 },
				{ lat: 9.45, lng: 9.65 },
				{ lat: 9.35, lng: 9.35 },
				{ lat: 9.38, lng: 9.05 },
				{ lat: 9.48, lng: 8.75 },
				{ lat: 9.65, lng: 8.55 },
				{ lat: 9.95, lng: 8.45 },
				{ lat: 10.15, lng: 8.48 },
				{ lat: 10.35, lng: 8.55 },
			],
		},
		{
			name: "Bauchi State",
			coordinates: [
				{ lat: 12.45, lng: 9.35 },
				{ lat: 12.65, lng: 9.65 },
				{ lat: 12.75, lng: 9.95 },
				{ lat: 12.78, lng: 10.25 },
				{ lat: 12.72, lng: 10.55 },
				{ lat: 12.58, lng: 10.85 },
				{ lat: 12.35, lng: 11.05 },
				{ lat: 12.05, lng: 11.15 },
				{ lat: 11.75, lng: 11.08 },
				{ lat: 11.45, lng: 10.95 },
				{ lat: 11.15, lng: 10.75 },
				{ lat: 10.95, lng: 10.55 },
				{ lat: 10.85, lng: 10.25 },
				{ lat: 10.88, lng: 9.95 },
				{ lat: 10.98, lng: 9.65 },
				{ lat: 11.15, lng: 9.45 },
				{ lat: 11.45, lng: 9.35 },
				{ lat: 11.75, lng: 9.32 },
				{ lat: 12.05, lng: 9.35 },
				{ lat: 12.25, lng: 9.42 },
				{ lat: 12.45, lng: 9.35 },
			],
		},
	];

	// Add each state as a polygon feature
	nigerianStates.forEach((state) => {
		const feature = new google.maps.Data.Feature({
			geometry: new google.maps.Data.Polygon([state.coordinates]),
			properties: {
				name: state.state || state.name,
			},
		});

		dataLayer.add(feature);
	});
}

// Alternative function to load from GeoJSON (more accurate boundaries)
export function loadGeoJSONBoundaries(
	dataLayer: google.maps.Data,
	geoJsonUrl: string
) {
	// Load GeoJSON data
	dataLayer.loadGeoJson(geoJsonUrl, {}, (features) => {
		console.log(`Loaded ${features.length} administrative boundary features`);
	});
}

// Function to load boundaries from Nigeria's official boundary data
// For production, use: https://raw.githubusercontent.com/holutahyour/nigeria-geojson/main/states.geojson
export async function loadOfficialNigerianBoundaries(
	dataLayer: google.maps.Data
) {
	try {
		// In production, you would use the actual GeoJSON URL
		// const response = await fetch('https://raw.githubusercontent.com/holutahyour/nigeria-geojson/main/states.geojson');
		// const geoJsonData = await response.json();

		// For now, we'll use the improved coordinate data above
		// This provides much better state boundary shapes than squares
		console.log(
			"Loading improved Nigerian state boundaries with realistic shapes..."
		);

		// The loadNigerianStates function above now provides realistic boundary shapes
		// that follow the actual contours of Nigerian states instead of rectangles
	} catch (error) {
		console.error("Error loading official boundaries:", error);
		// Fallback to our improved coordinate data
	}
}
